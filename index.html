<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Guess the Image Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Osnovni reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #f6d365, #fda085); color: #333; }
    
    /* Početna stranica – samo kategorije */
    #start-container, #animal-subcategory-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 90%;
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    #start-container button,
    #animal-subcategory-container button {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #3498db;
      color: #fff;
      transition: 0.3s;
    }
    #start-container button:hover,
    #animal-subcategory-container button:hover {
      opacity: 0.85;
    }
    #animal-subcategory-container p { margin-bottom: 10px; font-size: 18px; }

    /* Igra – landscape layout */
    #game-container {
      display: none; /* prikazuje se tek nakon odabira kategorije */
      width: 100%;
      height: 90vh;
      max-height: 100vh;
      background: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: row;
    }
    /* Lijeva strana – slika (popunjava što više visine) */
    #game-left {
      flex: 2;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    #image-container {
      width: 100%;
      height: 100%;
    }
    #image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* Desna strana – kontrole */
    #game-right {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      background: #f7f7f7;
    }
    #game-info, #scores, #winner {
      font-size: 20px;
      text-align: center;
    }
    .control-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .control-buttons button {
      padding: 15px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    .control-buttons button:hover { opacity: 0.85; }
    .sofia { background-color: #f39c12; color: #fff; }
    .matija { background-color: #3498db; color: #fff; }
    .next { background-color: #2ecc71; color: #fff; }
    .back { background-color: #e74c3c; color: #fff; }
    .fs { background-color: #8e44ad; color: #fff; }
  </style>
</head>
<body>
  <!-- Početna stranica: Glavne kategorije -->
  <div id="start-container">
    <h2>Odaberite kategoriju</h2>
    <button data-category="animals">Životinje</button>
    <button data-category="nature">Priroda</button>
    <button data-category="faces">Pogađanje emocija (lica)</button>
    <button data-category="emotions">Ljudske emocije</button>
    <button data-category="occupations">Zanimanja</button>
  </div>

  <!-- Podkategorije za Životinje (prikazuju se ako se klikne Životinje) -->
  <div id="animal-subcategory-container" style="display: none;">
    <p>Odaberite podkategoriju životinja:</p>
    <button data-subcategory="animals">Opće životinje</button>
    <button data-subcategory="domestic animals">Domaće životinje</button>
    <button data-subcategory="wild animals">Divlje životinje</button>
    <button data-subcategory="farm animals">Životinje sa farme</button>
    <button id="back-to-main">Nazad</button>
  </div>

  <!-- Igra: Landscape layout (bez naslova) -->
  <div id="game-container">
    <!-- Lijeva strana: Slika (popunjava cijelu visinu) -->
    <div id="game-left">
      <div id="image-container">
        <img id="current-image" src="" alt="Slika">
      </div>
    </div>
    <!-- Desna strana: Kontrole -->
    <div id="game-right">
      <div id="game-info">Runda: <span id="round-number">0</span>/<span id="total-rounds">10</span></div>
      <div id="scores">Sofia: <span id="sofia-score">0</span> | Matija: <span id="matija-score">0</span></div>
      <div class="control-buttons">
        <button class="sofia" id="sofia-btn">+1 Sofia</button>
        <button class="matija" id="matija-btn">+1 Matija</button>
        <button class="next" id="next-btn">Next</button>
        <button class="fs" id="fs-btn">Fullscreen On/Off</button>
        <button class="back" id="back-btn">Nazad</button>
      </div>
      <div id="winner"></div>
    </div>
  </div>

  <script>
    /* GLOBAL STATE */
    const totalRounds = 10;
    document.getElementById("total-rounds").textContent = totalRounds;
    
    let currentRound = 0, sofiaScore = 0, matijaScore = 0;
    let validImages = [];
    let currentIndex = 0;
    let currentQuery = "";
    
    // DOM selektori
    const startContainer = document.getElementById("start-container");
    const animalSubContainer = document.getElementById("animal-subcategory-container");
    const gameContainer = document.getElementById("game-container");
    const currentImageEl = document.getElementById("current-image");
    const roundNumberEl = document.getElementById("round-number");
    const sofiaScoreEl = document.getElementById("sofia-score");
    const matijaScoreEl = document.getElementById("matija-score");
    const winnerEl = document.getElementById("winner");
    const sofiaBtn = document.getElementById("sofia-btn");
    const matijaBtn = document.getElementById("matija-btn");
    const nextBtn = document.getElementById("next-btn");
    const fsBtn = document.getElementById("fs-btn");
    const backBtn = document.getElementById("back-btn");
    const backToMainBtn = document.getElementById("back-to-main");
    
    /* MAIN CATEGORY SELECTION */
    document.querySelectorAll("#start-container button").forEach(btn => {
      btn.addEventListener("click", () => {
        const cat = btn.getAttribute("data-category");
        // Ako je odabrano "animals", prvo prikaži podkategorije
        if(cat === "animals") {
          startContainer.style.display = "none";
          animalSubContainer.style.display = "flex";
        } else {
          currentQuery = getQueryForCategory(cat);
          startGame();
        }
      });
    });
    
    /* ANIMAL SUBCATEGORY SELECTION */
    document.querySelectorAll("#animal-subcategory-container button[data-subcategory]").forEach(btn => {
      btn.addEventListener("click", () => {
        currentQuery = btn.getAttribute("data-subcategory");
        animalSubContainer.style.display = "none";
        startGame();
      });
    });
    backToMainBtn.addEventListener("click", () => {
      animalSubContainer.style.display = "none";
      startContainer.style.display = "flex";
    });
    
    /* Pomoćna funkcija za mapiranje kategorije na query string */
    function getQueryForCategory(cat) {
      switch(cat) {
        case "nature": return "nature";
        case "faces": return "human face";
        case "emotions": return "emotional expression";
        case "occupations": return "occupations";
        default: return cat;
      }
    }
    
    /* Start igre – prikazuje game-container i dohvaća slike */
    async function startGame() {
      // Reset stanja
      resetGame();
      startContainer.style.display = "none";
      animalSubContainer.style.display = "none";
      gameContainer.style.display = "flex";
      
      // Dohvati slike s Unsplash API-ja
      validImages = await fetchUnsplashImages(currentQuery, totalRounds);
      if(validImages.length === 0) {
        winnerEl.textContent = "Nema dovoljno validnih slika za ovu kategoriju!";
        return;
      }
      showNextImage();
    }
    
    function resetGame() {
      currentRound = 0;
      sofiaScore = 0;
      matijaScore = 0;
      currentIndex = 0;
      validImages = [];
      roundNumberEl.textContent = "0";
      sofiaScoreEl.textContent = "0";
      matijaScoreEl.textContent = "0";
      winnerEl.textContent = "";
      currentImageEl.src = "";
    }
    
    /* Unsplash API: Koristi se službeni API sa zadanom tajnom ključem */
    async function fetchUnsplashImages(query, count) {
      const accessKey = "1-SnSlQgPjJHmFfy1v5K3Xqm9cWXIk7xkGq5nILLFW0"; // Vaš ključ
      const url = `https://api.unsplash.com/photos/random?query=${encodeURIComponent(query)}&count=${count}&client_id=${accessKey}`;
      try {
        const response = await fetch(url);
        if(!response.ok) {
          console.error("Error fetching images:", response.statusText);
          return [];
        }
        const data = await response.json();
        // Vraća niz URL-ova slika (regular veličina)
        return data.map(photo => photo.urls.regular);
      } catch (error) {
        console.error("Fetch error:", error);
        return [];
      }
    }
    
    /* Prikaz sljedeće slike */
    function showNextImage() {
      currentRound++;
      roundNumberEl.textContent = currentRound;
      if(currentRound > totalRounds || currentIndex >= validImages.length) {
        declareWinner();
        return;
      }
      currentImageEl.src = validImages[currentIndex];
      currentIndex++;
    }
    
    /* Dugmad za dodavanje poena i Next */
    sofiaBtn.addEventListener("click", () => {
      if(currentRound <= totalRounds) {
        sofiaScore++;
        sofiaScoreEl.textContent = sofiaScore;
        showNextImage();
      }
    });
    matijaBtn.addEventListener("click", () => {
      if(currentRound <= totalRounds) {
        matijaScore++;
        matijaScoreEl.textContent = matijaScore;
        showNextImage();
      }
    });
    nextBtn.addEventListener("click", () => {
      // Samo prelazak na sljedeću sliku, bez dodavanja poena
      if(currentRound <= totalRounds) {
        showNextImage();
      }
    });
    
    /* Fullscreen toggle */
    fsBtn.addEventListener("click", () => {
      if(!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.error(`Error attempting to enable fullscreen mode: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    });
    
    /* Dugme Back – vraća na početni ekran */
    backBtn.addEventListener("click", () => {
      gameContainer.style.display = "none";
      startContainer.style.display = "flex";
      resetGame();
    });
    
    /* Nakon završetka igre, proglašava pobjednika */
    function declareWinner() {
      currentImageEl.src = "";
      if(sofiaScore > matijaScore) {
        winnerEl.textContent = "Pobednik je Sofia!";
      } else if(matijaScore > sofiaScore) {
        winnerEl.textContent = "Pobednik je Matija!";
      } else {
        winnerEl.textContent = "Nerešeno!";
      }
    }
  </script>
</body>
</html>