<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Guess The Image Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React, ReactDOM, Framer Motion, Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Reset & Basic Styling */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #f6d365, #fda085);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    #root {
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
    }

    /* Category Screen Styles */
    .category-screen {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 20px;
      width: 90%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    .category-screen h2 {
      margin-bottom: 10px;
    }
    .cat-button {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      color: #fff;
      cursor: pointer;
      background: #3498db;
      transition: 0.3s;
    }
    .cat-button:hover {
      opacity: 0.8;
    }
    .cat-sub {
      background: #7f8c8d;
      margin-left: 20px;
    }
    hr {
      width: 100%;
    }

    /* Game Screen Layout (landscape) */
    .game-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: stretch;
      gap: 20px;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 1000px;
      margin: 0 auto;
      position: relative;
    }
    /* Fullscreen button */
    .fullscreen-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #9b59b6;
      color: #fff;
      border: none;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    .fullscreen-btn:hover {
      opacity: 0.8;
    }
    /* Left Side: Image */
    .game-left {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .img-wrapper {
      width: 100%;
      max-width: 600px;
      height: 80vh;
      background: #ccc;
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .img-wrapper img {
      object-fit: cover;
      width: 100%;
      height: 100%;
    }
    /* Right Side: Controls */
    .game-right {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 20px;
    }
    .score-panel {
      text-align: center;
      font-size: 18px;
    }
    .score-buttons,
    .navigation-buttons {
      display: flex;
      gap: 10px;
    }
    .score-btn,
    .nav-btn {
      border: none;
      border-radius: 8px;
      font-size: 16px;
      padding: 12px;
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
      text-align: center;
    }
    .score-btn:hover,
    .nav-btn:hover {
      opacity: 0.8;
    }
    .sofia-btn {
      background-color: #f39c12;
    }
    .matija-btn {
      background-color: #3498db;
    }
    .skip-btn {
      background-color: #7f8c8d;
    }
    .back-btn {
      background-color: #e74c3c;
    }
    .winner {
      font-size: 20px;
      font-weight: bold;
      color: #d35400;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Our React code is transpiled by Babel -->
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { motion, AnimatePresence } = window["framer-motion"];

    const TOTAL_ROUNDS = 10;
    const UNSPLASH_ACCESS_KEY = "1-SnSlQgPjJHmFfy1v5K3Xqm9cWXIk7xkGq5nILLFW0";

    // Toggle fullscreen mode
    function toggleFullScreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen?.(); 
      } else {
        document.exitFullscreen?.();
      }
    }

    function App() {
      // screen: "category" or "game"
      const [screen, setScreen] = useState("category");
      const [selectedCategory, setSelectedCategory] = useState("");

      const handleCategoryClick = (category) => {
        setSelectedCategory(category);
        setScreen("game");
      };

      return (
        <div>
          <AnimatePresence mode="wait">
            {screen === "category" && (
              <motion.div
                key="categoryScreen"
                className="category-screen"
                initial={{ opacity: 0, y: 50 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -50 }}
                transition={{ duration: 0.4 }}
              >
                <h2>Odaberite Kategoriju</h2>

                {/* 1. Životinje */}
                <button className="cat-button" onClick={() => handleCategoryClick("animals")}>
                  Životinje (general)
                </button>
                <button className="cat-button cat-sub" onClick={() => handleCategoryClick("domestic animals")}>
                  Životinje - Domaće
                </button>
                <button className="cat-button cat-sub" onClick={() => handleCategoryClick("wild animals")}>
                  Životinje - Divlje
                </button>
                <button className="cat-button cat-sub" onClick={() => handleCategoryClick("farm animals")}>
                  Životinje - Farma
                </button>
                <button className="cat-button cat-sub" onClick={() => handleCategoryClick("sea life")}>
                  Životinje - Morske
                </button>

                <hr />

                {/* 2. Priroda */}
                <button className="cat-button" onClick={() => handleCategoryClick("nature")}>
                  Priroda
                </button>

                <hr />

                {/* 3. Zanimanja */}
                <button className="cat-button" onClick={() => handleCategoryClick("occupations jobs")}>
                  Zanimanja (general)
                </button>
                <button className="cat-button cat-sub" onClick={() => handleCategoryClick("pilot job")}>
                  Zanimanja - Pilot
                </button>
                <button className="cat-button cat-sub" onClick={() => handleCategoryClick("doctor job")}>
                  Zanimanja - Doktor
                </button>
                <button className="cat-button cat-sub" onClick={() => handleCategoryClick("policeman police")}>
                  Zanimanja - Policajac
                </button>

                <hr />

                {/* 4. Ljudske emocije */}
                <button className="cat-button" onClick={() => handleCategoryClick("people face expressions")}>
                  Ljudske emocije (Faces)
                </button>
              </motion.div>
            )}

            {screen === "game" && (
              <GameScreen
                key="gameScreen"
                category={selectedCategory}
                onBack={() => {
                  setScreen("category");
                  setSelectedCategory("");
                }}
              />
            )}
          </AnimatePresence>
        </div>
      );
    }

    function GameScreen({ category, onBack }) {
      const [round, setRound] = useState(0);
      const [sofiaScore, setSofiaScore] = useState(0);
      const [matijaScore, setMatijaScore] = useState(0);
      const [imageUrls, setImageUrls] = useState([]);
      const [currentIndex, setCurrentIndex] = useState(0);
      const [winner, setWinner] = useState("");

      // Fetch images when category changes
      useEffect(() => {
        fetchImages(category, TOTAL_ROUNDS).then((urls) => {
          setImageUrls(urls || []);
          setRound(0);
          setCurrentIndex(0);
          setWinner("");
        });
      }, [category]);

      // End game if rounds exceeded
      useEffect(() => {
        if (round > TOTAL_ROUNDS || currentIndex >= imageUrls.length) {
          declareWinner();
        }
      }, [round, currentIndex, imageUrls]);

      const handleNext = (scoreFor) => {
        if (!winner) {
          setRound((r) => r + 1);
          if (scoreFor === "sofia") setSofiaScore((s) => s + 1);
          if (scoreFor === "matija") setMatijaScore((m) => m + 1);
          setCurrentIndex((idx) => idx + 1);
        }
      };

      const handleSkip = () => {
        if (!winner) {
          setRound((r) => r + 1);
          setCurrentIndex((idx) => idx + 1);
        }
      };

      const declareWinner = () => {
        if (winner) return;
        let result = "";
        if (sofiaScore > matijaScore) result = "Pobjednik je Sofia!";
        else if (matijaScore > sofiaScore) result = "Pobjednik je Matija!";
        else result = "Nerešeno!";
        setWinner(result);
      };

      const currentImage = imageUrls[currentIndex] || "";

      return (
        <motion.div
          className="game-container"
          initial={{ opacity: 0, x: 100 }}
          animate={{ opacity: 1, x: 0 }}
          exit={{ opacity: 0, x: -100 }}
          transition={{ duration: 0.5 }}
        >
          <button className="fullscreen-btn" onClick={toggleFullScreen}>
            Fullscreen
          </button>

          <div className="game-left">
            <div className="img-wrapper">
              {currentImage ? (
                <motion.img
                  key={currentImage}
                  src={currentImage}
                  alt="Current"
                  initial={{ scale: 0.9, opacity: 0 }}
                  animate={{ scale: 1, opacity: 1 }}
                  exit={{ scale: 0.9, opacity: 0 }}
                  transition={{ duration: 0.4 }}
                />
              ) : (
                <p>Loading...</p>
              )}
            </div>
          </div>

          <div className="game-right">
            <div className="score-panel">
              Runda: {round}/{TOTAL_ROUNDS} <br />
              Sofia: {sofiaScore} | Matija: {matijaScore}
            </div>

            {!winner && (
              <>
                <div className="score-buttons">
                  <button className="score-btn sofia-btn" onClick={() => handleNext("sofia")}>
                    +1 Sofia
                  </button>
                  <button className="score-btn matija-btn" onClick={() => handleNext("matija")}>
                    +1 Matija
                  </button>
                </div>
                <div className="navigation-buttons">
                  <button className="nav-btn skip-btn" onClick={handleSkip}>
                    Next (Skip)
                  </button>
                  <button className="nav-btn back-btn" onClick={onBack}>
                    Back
                  </button>
                </div>
              </>
            )}

            {winner && (
              <div style={{ textAlign: "center" }}>
                <p className="winner">{winner}</p>
                <button className="nav-btn back-btn" onClick={onBack}>
                  Nazad
                </button>
              </div>
            )}
          </div>
        </motion.div>
      );
    }

    // Fetch images using Unsplash API
    async function fetchImages(query, count) {
      const url = `https://api.unsplash.com/photos/random?query=${encodeURIComponent(query)}&count=${count}&client_id=${UNSPLASH_ACCESS_KEY}`;
      try {
        const res = await fetch(url);
        if (!res.ok) {
          console.error("Unsplash fetch error:", res.statusText);
          return [];
        }
        const data = await res.json();
        return data.map((item) => item.urls.regular);
      } catch (err) {
        console.error("Fetch error:", err);
        return [];
      }
    }

    // Render the App
    const rootEl = document.getElementById("root");
    ReactDOM.createRoot(rootEl).render(<App />);
  </script>
</body>
</html>